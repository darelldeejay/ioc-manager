<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Notificaciones</title>
</head>
<body>
    <h1>Test de Renderizado de Notificaciones</h1>
    <div id="output" style="white-space: pre; font-family: monospace; background: #f0f0f0; padding: 10px; border: 1px solid #ccc;">Cargando...</div>
    <div id="error" style="color: red; margin-top: 10px;"></div>
    
    <script>
        window.addEventListener('load', function() {
            try {
                // NOTA: La siguiente linea NO debe tener espacios entre las llaves
                const serverMessages = [
                    {% for category, message in (messages or []) %}
                        { "category": "{{ category }}", "message": {{ message | tojson }} }{% if not loop.last %},{% endif %}
                    {% endfor %}
                ];
                
                console.log('serverMessages:', serverMessages);
                const outDoc = document.getElementById('output');
                if (outDoc) {
                    outDoc.textContent = 'EXITO: ' + JSON.stringify(serverMessages, null, 2);
                    outDoc.style.backgroundColor = '#e8f5e9';
                    outDoc.style.border = '2px solid green';
                }
            } catch (e) {
                console.error('ERROR JS:', e);
                const errDoc = document.getElementById('error');
                if (errDoc) errDoc.textContent = 'Error ejecutando JS: ' + e.message;
            }
        });
    </script>
</body>
</html>